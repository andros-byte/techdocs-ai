import streamlit as st
from openai import OpenAI
from fpdf import FPDF
import base64

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
st.set_page_config(page_title="TechDocs AI Pro", page_icon="üìÑ")

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–ª—ñ—î–Ω—Ç–∞ OpenAI (–ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –∫–ª—é—á –¥–æ–¥–∞–Ω–æ –≤ Secrets Streamlit)
client = OpenAI(api_key=st.secrets["OPENAI_API_KEY"])

st.title("üìÑ TechDocs AI Professional")
st.subheader("–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π –¥–ª—è –µ–Ω–µ—Ä–≥–æ–æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è")

# –û–ø–∏—Å –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
st.write("–¶–µ–π —Å–µ—Ä–≤—ñ—Å –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º —à–≤–∏–¥–∫–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é –¥–æ —ñ–Ω–≤–µ—Ä—Ç–æ—Ä—ñ–≤, –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ñ–≤ –∞–±–æ —Å–∏—Å—Ç–µ–º –∂–∏–≤–ª–µ–Ω–Ω—è.")

# –í–≤—ñ–¥ –¥–∞–Ω–∏—Ö
equipment = st.text_input("–í–≤–µ–¥—ñ—Ç—å –º–æ–¥–µ–ª—å –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, EcoFlow Delta 2 –∞–±–æ –Ü–Ω–≤–µ—Ä—Ç–æ—Ä Must 3–∫–í—Ç):")
problem = st.text_area("–û–ø–∏—à—ñ—Ç—å –∑–∞–≤–¥–∞–Ω–Ω—è –∞–±–æ –ø—Ä–æ–±–ª–µ–º—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: –ø–µ—Ä—à–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –º–µ—Ä–µ–∂—ñ –∞–±–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞—Ä—è–¥–∫–∏ –≤—ñ–¥ –ø–∞–Ω–µ–ª–µ–π):")

if st.button("–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é"):
    if equipment and problem:
        with st.spinner('–®–Ü –∞–Ω–∞–ª—ñ–∑—É—î –¥–∞–Ω—ñ —Ç–∞ —Å—Ç–≤–æ—Ä—é—î –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é...'):
            try:
                # –ó–∞–ø–∏—Ç –¥–æ OpenAI
                response = client.chat.completions.create(
                    model="gpt-4o",
                    messages=[
                        {"role": "system", "content": "–¢–∏ ‚Äî –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π —Ç–µ—Ö–Ω—ñ—á–Ω–∏–π –ø–∏—Å—å–º–µ–Ω–Ω–∏–∫. –°—Ç–≤–æ—Ä–∏ —á—ñ—Ç–∫—É, –±–µ–∑–ø–µ—á–Ω—É —Ç–∞ –∑—Ä–æ–∑—É–º—ñ–ª—É –ø–æ–∫—Ä–æ–∫–æ–≤—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é."},
                        {"role": "user", "content": f"–°—Ç–≤–æ—Ä–∏ —Ç–µ—Ö–Ω—ñ—á–Ω—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é –¥–ª—è {equipment}. –ü—Ä–æ–±–ª–µ–º–∞/–∑–∞–≤–¥–∞–Ω–Ω—è: {problem}. –î–æ–¥–∞–π —Ä–æ–∑–¥—ñ–ª –∑ —Ç–µ—Ö–Ω—ñ–∫–∏ –±–µ–∑–ø–µ–∫–∏."}
                    ]
                )
                
                result = response.choices[0].message.content
                st.markdown("### –í–∞—à–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:")
                st.write(result)

                # –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è PDF
                pdf = FPDF()
                pdf.add_page()
                # –ü—Ä–∏–º—ñ—Ç–∫–∞: –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –∫–∏—Ä–∏–ª–∏—Ü—ñ –≤ PDF –ø–æ—Ç—Ä—ñ–±–µ–Ω —à—Ä–∏—Ñ—Ç, 
                # –∞–ª–µ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–∏–≤–æ–¥–∏–º–æ —Ç–µ–∫—Å—Ç —É –±—Ä–∞—É–∑–µ—Ä
                
                st.success("‚úÖ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –≥–æ—Ç–æ–≤–∞!")
                
            except Exception as e:
                st.error(f"–ü–æ–º–∏–ª–∫–∞: {e}")
    else:
        st.warning("–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–±–∏–¥–≤–∞ –ø–æ–ª—è.")

# –ë–ª–æ–∫ –æ–ø–ª–∞—Ç–∏ —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏
st.divider()
st.markdown("""
### üí∞ –ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ–µ–∫—Ç
–Ø–∫—â–æ —Ü–µ–π —Å–µ—Ä–≤—ñ—Å –¥–æ–ø–æ–º—ñ–≥ –≤–∞–º –∑–∞–æ—â–∞–¥–∏—Ç–∏ —á–∞—Å ‚Äî –≤–∏ –º–æ–∂–µ—Ç–µ –ø—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ —Ç–∞ –Ω–∞–±–ª–∏–∑–∏—Ç–∏ –Ω–∞—à—É –ø–µ—Ä–µ–º–æ–≥—É.
**–í—Å—ñ –∫–æ—à—Ç–∏ –π–¥—É—Ç—å –Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫—É —Å—ñ–º'—ó –≤ —É–º–æ–≤–∞—Ö –≤—ñ–π–Ω–∏ —Ç–∞ –¥–æ–Ω–∞—Ç–∏ –¥–ª—è –ó–°–£ üá∫üá¶**

**PayPal:** `–¢–í–Ü–ô_PAYPAL_EMAIL@gmail.com` *(–±—É–¥—å –ª–∞—Å–∫–∞, –≤–ø–∏—à–∏ —Å–≤—ñ–π email —Ç—É—Ç)*
""")
